<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        cryptography For DeFi 101</title>
    <link rel="stylesheet" href="./main-style.css">
    <link rel="stylesheet" href="./code-highlight.css">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            justify-items: center;
            gap: 1rem 1rem;
            border: #222222 solid .5rem;
            border-radius: 1rem;
            padding: 1rem;
        }
        
        .grid-item {
            background-color: #222222;
            color: aliceblue;
            width: 100%;
            border-radius: 1rem;
            text-align: center;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        
        .grid-2-item {
            border: #e06c75 solid .5rem;
            border-radius: 1rem;
            text-align: center;
            padding-top: 1rem;
            padding-bottom: 1rem;
            width: 35vw;
        }
        
        code {
            display: inline-block;
        }
        
        .color-red {
            color: #e06c75;
        }
        
        .color-blue {
            color: #3083ae;
        }
        
        .color-light-blue {
            color: #5fafef;
        }
        
        .color-orange {
            color: #d19a5c;
        }
        
        .color-purple {
            color: #c678dd;
        }
        
        .color-yellow {
            color: #ffd11d;
        }
        
        .color-green {
            color: #98c363;
        }
        
        .blockchain-img {
            height: 40vh;
        }
    </style>
</head>

<body>
    <h1>Noted Topics</h1>
    <ol>
        <li>What is exactly Cryptography?</li>
        <ul>
            <li>Cryptography != Cryptocurrency</li>
            <li>Cryptocurrency = 10%? Cryptography + Distributed system + Finance + ...</li>
            <li>
                Cryptography => Communication in the presence of adversaries.
            </li>
            <li>Jobs</li>
            <ul>
                <li>Secret Protection</li>
                <li>Integrity Protection</li>
            </ul>
            <li>2 Worlds Setting</li>
            <ul>
                <li>Symmetric</li>
                <li>Asymmetric</li>
            </ul>
            <div class="grid-3">
                <div></div>
                <div>
                    <p>
                        Sym
                    </p>
                </div>
                <div>
                    <p>Asym</p>
                </div>
                <div>
                    <p>Secret</p>
                </div>
                <div class="grid-item">
                    <p>SE</p>
                </div>
                <div class="grid-item">
                    <p>AE</p>
                </div>
                <div>
                    <p>Integrity</p>
                </div>
                <div class="grid-item">
                    <p>MAC</p>
                </div>
                <div class="grid-item">
                    <p>DS</p>
                </div>

            </div>
        </ul>


        <li>Symmetric</li>
        <ul>
            <li>Key Setup</li>
            <li>Symmetric Encryption</li>
            <ul>
                <li>Ex: One-time Pad</li>
                <pre><code>def SymmetricEncrypt(Key, data):
    return Key <span class="color-light-blue">xor</span> data
</code></pre>
                <pre><code>def SymmetricDecrypt(Key, data):
    return Key <span class="color-light-blue">xor</span> data
</code></pre>
                <pre><code><span class="color-yellow">0</span> <span class="color-light-blue">xor</span> <span class="color-yellow">0</span> = 0
<span class="color-yellow">0</span> <span class="color-light-blue">xor</span> <span class="color-green">1</span> = 1
<span class="color-green">1</span> <span class="color-light-blue">xor</span> <span class="color-yellow">0</span> = 1
<span class="color-green">1</span> <span class="color-light-blue">xor</span> <span class="color-green">1</span> = 0
</code></pre>
                <pre><code>msg = "1100"
<span class="color-red">Key</span> = "0110"

cipher_text = SymmetricEncrypt(<span class="color-red">Key</span>, msg) => "1010"
send(ciphere_text)</code></pre>
                <pre><code>assume <span class="color-red">Key</span>
cipher_text = receive()

msg = SymmetricDecrypt(<span class="color-red">Key</span>, cipher_text)</code></pre>
                <li>Why One-time Pad is perfect secrecy but it cannot be used in real life.</li>
                <p>
                    \(n \in Z^+ \)
                </p>
                <p>
                    \(a,b \in \{0,1\}^n \)
                </p>
                <p>
                    \(Pr[M = a |C = b] = Pr[M=a]\)
                </p>
                <div class="grid-2">
                    <div class="grid-2-item">
                        cipher_text = "1010" <br> msg = ?
                    </div>
                    <div class="grid-2-item">
                        msg = ?
                    </div>
                </div>
                <li class="skip">Symmetric Encryption = Modes of operation + Block Ciphers</li>
                <li class="skip">Modes of operation</li>
                <ul class="skip">
                    <li>Electronic Code Book mode (ECB)</li>
                    <li>Cipher Block Chaining mode (CBC$)</li>
                    <li>Cipher Block Chaining mode (CBCC)</li>
                    <li>Counter mode (CTRC)</li>
                    <li>Counter mode (CTR$)</li>
                </ul>
                <li class="skip">Securiy Proofs</li>
                <ul class="skip">
                    <li>IND-CPA</li>
                    <li>IND-CPA</li>
                    <li>IND-CCA</li>
                </ul>
            </ul>
            <li class="skip">Message Authentication Code (MAC)</li>
            <ul class="skip">
                <li>Why do we need integrity protection?</li>
                <li class="skip">Securiy Proofs</li>
                <ul class="skip">
                    <li>WUF-CMA</li>
                    <li>SUF-CMA
                    </li>

                </ul>
            </ul>
        </ul>
        <li>Asymmetric</li>
        <ul>
            <li>Key Setup</li>

            <li>Key generation</li>
            <pre><code><span class="color-orange">K_E</span>, <span class="color-purple">K_D</span> = keygen(...)

Asymmetric Encryption: 
    <span class="color-orange">K_E</span> => <span class="color-blue">Public Key</span>, <span class="color-purple">K_D</span> => <span class="color-red">Private Key</span> 

Digital Signature:
    <span class="color-purple">K_D</span> => <span class="color-blue">Public Key</span>, <span class="color-orange">K_E</span> => <span class="color-red">Private Key</span> </code></pre>
            <li class="skip">Asymmetric Encryption</li>
            <li>Digital Signature</li>
            <ul>
                <li>Sign</li>
                <pre><code><span class="color-orange">K_E</span>, <span class="color-purple">K_D</span> = keygen(...)
<span class="color-red">Private_Key</span> = <span class="color-orange">K_E</span>
<span class="color-blue">Public_Key</span> = <span class="color-purple">K_D</span>

msg = "HelloWorld"
tag = Sign(<span class="color-red">Private_Key</span>, msg)

send(msg, tag)</code></pre>
                <li>Verify</li>
                <pre><code>assume <span class="color-blue">Public_Key</span>

msg, tag = receive()
ok? = Verify(<span class="color-blue">Public_Key</span>, msg, tag)</code></pre>
                <li>Ex</li>
                A == 1 bitcoin ==> B
                <pre><code><span class="color-orange">K_E</span>, <span class="color-purple">K_D</span> = keygen(...)
<span class="color-red">Private_Key_A</span> = <span class="color-orange">K_E</span>
<span class="color-blue">Public_Key_A</span>  = <span class="color-purple">K_D</span>

msg = "A transferred 1 bitcoin to B"
tag = Sign(<span class="color-red">Private_Key_A</span>, msg) = "UXIJKF"

send(msg, tag)</code></pre>
                <pre><code>assume <span class="color-blue">Public_Key_A</span>
msg, tag = receive()

ok? = Verity(<span class="color-blue">Public_Key_A</span>, msg, tag)
</code></pre>
            </ul>
        </ul>

        <li>Items</li>
        <ul>
            <li class="skip">Block Ciphers</li>
            <ul class="skip">
                <li>DES, AES, etc.</li>
                <li>Securit Proofs</li>
                <ul>
                    <li>PRP-CPA</li>
                    <li>PRP-CCA</li>
                    <li>PRF</li>
                </ul>
            </ul>
            <li>Hash Function</li>
            <ul>
                <li>Input length and Fixed Output length => cannot contain the information of DATA</li>
                <pre><code>def hash(input):
    return input[:5] + input[5:10]</code></pre>
                <pre><code>hash( 153208924765030 ) =>           104567
hash( 15135456103421381230515 ) =>   060745
hash( 1128123054 ) =>                034335</code></pre>
            </ul>
            <li>Security Definitions</li>
            <ul>
                <li>Pre-image Resistance</li>
                <ul>
                    <li> It should be difficult to figure out what was hashed simply by looking at the hash value.
                    </li>
                </ul>
                <li>Collision Resistance</li>
                <ul>
                    <li>It should be difficult to figure out what are 2 inputs that have same hash.</li>
                </ul>
            </ul>
            <li class="skip">Security Proofs</li>
            <ul class="skip">
                <li>Pre-image attacks</li>
                <li>Second pre-image attacks</li>
                <li>Collision-finding attacks</li>
            </ul>
            <li>SHA256</li>
            <ul>
                <li>HelloWorld => 872e4e50ce9990d8b041330c47c9ddd11bec6b503ae9386a99da8584e9bb12c4</li>
                <li>HelloWorldd => 61b5db76aeef61f0b9357a31580a73b5c87c8e90eae8e350d13fe6307eae036e</li>
                <li>Pseudocode ref: <a href="https://en.wikipedia.org/wiki/SHA-2">wikipedia SHA-2</a>
                    <pre><code>for i from 0 to 63
    S1 := (e <span class="color-light-blue">rightrotate</span> 6) <span class="color-light-blue">xor</span> (e <span class="color-light-blue">rightrotate</span> 11) <span class="color-light-blue">xor</span> (e <span class="color-light-blue">rightrotate</span> 25)
    ch := (e <span class="color-light-blue">and</span> f) <span class="color-light-blue">xor</span> ((<span class="color-light-blue">not</span> e) <span class="color-light-blue">and</span> g)
    temp1 := h + S1 + ch + k[i] + w[i]
    S0 := (a <span class="color-light-blue">rightrotate</span> 2) <span class="color-light-blue">xor</span> (a <span class="color-light-blue">rightrotate</span> 13) <span class="color-light-blue">xor</span> (a <span class="color-light-blue">rightrotate</span> 22)
    maj := (a <span class="color-light-blue">and</span> b) <span class="color-light-blue">xor</span> (a <span class="color-light-blue">and</span> c) <span class="color-light-blue">xor</span> (b <span class="color-light-blue">and</span> c)
    temp2 := S0 + maj
</code></pre>
                </li>
            </ul>
            <li>Application(s)</li>
            <ul>
                <li>Password hashing (+salt)</li>
                <li>Hashing Game (Bitcoin consensus protocol, Proof of work)</li>
                <pre><code>N = 40
<span class="color-green">data</span> = receive()
while True:

    <span class="color-yellow">challenge</span> = Random()
    h = Hash( <span class="color-green">data</span> + <span class="color-yellow">challenge</span> )

    if(h[:N] == "0" * N):
        send(<span class="color-yellow">challenge</span>)
        break</code></pre>
            </ul>
        </ul>


        </ul>
        <li>Blockchain as a Hash chain</li>
        <img src="./blockchain.svg" class="blockchain-img" alt="">

        <li>Pseudo Random</li>
        <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span></pre></div>
        <br>
        <code>
    [0, 6, 2, 8, 0, 9, 2, 7, 6, 1]
</code>
        <ul>
            <li>
                <p>Seed Phrase</p>
            </li>
            <ul>
                <code>pitch refuse sort ozone heavy focus rough seek broccoli verify delay act</code>
                <p></p>
                <div class="highlight"><pre><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="s2">&quot;pitch refuse ...&quot;</span><span class="p">)</span></pre></div>
                <li>
                    <p><a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">BIP-0039 Wiki</a></p>
                </li>
                <img src="./bip39.png" alt="">
            </ul>

        </ul>
        <li>After class</li>
        <ol>
            <li>Textbook RSA</li>
            <ol>
                <li>Key generation</li>
                <ol>
                    <li>
                        <p>
                            \(p \in Z_P, q \in Z_P, p \ne q \)

                        </p>
                    </li>
                    <li>
                        </p>\(N = p \times q\)
                        <p>
                    </li>

                    <li>
                        <p>

                            \(\phi(N) = (p-1) \times (q-1)\)
                        </p>
                    </li>
                    <li>
                        <p>
                            Choose \(e\) when \(1 &lt e &lt \phi(N)\) ,and coprime with \( N\) and \( \phi(N)\) </p>
                    </li>
                    <li>
                        <p>
                            Choose \(d\) when \( (e \times d) mod \phi(N) = 1\)
                        </p>
                    </li>
                </ol>
                <li>Discrete Logarithm</li>
                <p>\( (d^k) mod (m) \)</p>
            </ol>

            <pre><code>keygen with p=3, q=17
N = 3 x 17 = 51
Phi(N) = 2 x 16 = 32
choose e from [2, 32] and coprime with 51, 32
coprime [<span class="color-orange">5</span>, 7, 11, 13, 19, 23, 29, 31]
pick at 0 => <span class="color-orange">K_E=5</span>
d=1, e*d=5, e*d % Phi(N)= 5
d=2, e*d=10, e*d % Phi(N)= 10
d=3, e*d=15, e*d % Phi(N)= 15
d=4, e*d=20, e*d % Phi(N)= 20
d=5, e*d=25, e*d % Phi(N)= 25
d=6, e*d=30, e*d % Phi(N)= 30
d=7, e*d=35, e*d % Phi(N)= 3
d=8, e*d=40, e*d % Phi(N)= 8
d=9, e*d=45, e*d % Phi(N)= 13
d=10, e*d=50, e*d % Phi(N)= 18
d=11, e*d=55, e*d % Phi(N)= 23
d=12, e*d=60, e*d % Phi(N)= 28
<span class="color-purple">d=13</span>, e*d=65, e*d % Phi(N)= 1
<span class="color-orange">K_E</span>={'key': <span class="color-orange">5</span>, 'mod': 51}
<span class="color-purple">K_D</span>={'key': <span class="color-purple">13</span>, 'mod': 51}
msg=6
6**<span class="color-orange">5</span> mod 51 = 24
cipher_text=24
24**<span class="color-purple">13</span> mod 51 = 6</code></pre>

            <pre><code>keygen with p=3, q=17
N = 3 x 17 = 51
Phi(N) = 2 x 16 = 32
choose e from [2, 32] and coprime with 51, 32
coprime [5, 7, 11, <span class="color-orange">13</span>, 19, 23, 29, 31]
pick at 3 => <span class="color-orange">K_E=13</span>
d=1, e*d=13, e*d % Phi(N)= 13
d=2, e*d=26, e*d % Phi(N)= 26
d=3, e*d=39, e*d % Phi(N)= 7
d=4, e*d=52, e*d % Phi(N)= 20
<span class="color-purple">d=5</span>, e*d=65, e*d % Phi(N)= 1
<span class="color-orange">K_E</span>={'key': <span class="color-orange">13</span>, 'mod': 51}
<span class="color-purple">K_D</span>={'key': <span class="color-purple">5</span>, 'mod': 51}
msg=6
6**<span class="color-orange">13</span> mod 51 = 27
cipher_text=27
27**<span class="color-purple">5</span> mod 51 = 6</code></pre>
            <pre><code>keygen with p=2, q=7
N = 2 x 7 = 14
Phi(N) = 1 x 6 = 6
choose e from [2, 6] and coprime with 14, 6
coprime [<span class="color-orange">5</span>]
pick at 0 => <span class="color-orange">K_E=5</span>
d=1, e*d=5, e*d % Phi(N)= 5
d=2, e*d=10, e*d % Phi(N)= 4
d=3, e*d=15, e*d % Phi(N)= 3
d=4, e*d=20, e*d % Phi(N)= 2
d=5, e*d=25, e*d % Phi(N)= 1
d=6, e*d=30, e*d % Phi(N)= 0
d=7, e*d=35, e*d % Phi(N)= 5
d=8, e*d=40, e*d % Phi(N)= 4
d=9, e*d=45, e*d % Phi(N)= 3
d=10, e*d=50, e*d % Phi(N)= 2
<span class="color-purple">d=11</span>, e*d=55, e*d % Phi(N)= 1
<span class="color-orange">K_E</span>={'key': <span class="color-orange">5</span>, 'mod': 14}
<span class="color-purple">K_D</span>={'key': <span class="color-purple">11</span>, 'mod': 14}
msg=2
2**<span class="color-orange">5</span> mod 14 = 4
cipher_text=4
4**<span class="color-purple">11</span> mod 14 = 2
</code></pre>
        </ol>
    </ol>
</body>

</html>